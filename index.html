<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pok√©mon Classifier</title>
    <style>
        .no-margin-ul {
            margin: 0;
        }

        .bold {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h2>Is it Pikachu, Bulbasaur, or Charmander?</h2>
    <h2>Danielle Turner, David Higley, Joseph Shapiro</h2>
    <input type="file" id="imageUpload" accept="image/*" onchange="handleImage(event)">
    <p>
        Current status: <span id="status-output">Loading model...</span>
    </p>
    <p>
        Model output: <span id="model-output"></span>
    </p>

    <script type="module">
        import { createClassifier } from "https://cdn.jsdelivr.net/npm/@annexdev/annx@latest";

        let model;
        let classifier;

        const statusDict = [
            "Waiting for file",
            "Loading file",
            "Performing inference",
            "Inference complete"
        ];

        const modelClasses = [
            "Bulbasaur",
            "Charmander",
            "Pikachu"
        ];

        const statusOutput = document.getElementById("status-output");

        function sortedClasses(classProbabilities) {
            const sorted = classProbabilities
                .map((prob, index) => [prob, index])
                .sort((a, b) => b[0] - a[0]);

            return sorted.map(([prob, index]) => ({
                index,
                name: modelClasses[index],
                probability: prob
            }));
        }

        async function handleImage(event) {
            const file = event.target.files[0];
            if (!file) return;

            statusOutput.textContent = statusDict[1];
            const img = new Image();
            img.src = URL.createObjectURL(file);

            img.onload = async () => {
                statusOutput.textContent = statusDict[2];

                const prediction = await classifier.classify(img);
                const resultClasses = sortedClasses(prediction);

                const outputElement = document.getElementById("model-output");
                outputElement.replaceChildren();

                resultClasses.forEach((item, index) => {
                    const outputTitle = document.createElement("span");
                    const outputData = document.createElement("ul");
                    const dataClassId = document.createElement("li");
                    const dataClassProb = document.createElement("li");
                    const outputSpacer = document.createElement("br");

                    if (index === 0) {
                        outputTitle.classList.add("bold");
                    }
                    outputData.classList.add("no-margin-ul");

                    outputTitle.textContent = item.name;
                    dataClassId.textContent = `Class id: ${item.index}`;
                    dataClassProb.textContent = `Probability: ${item.probability.toFixed(4)}`;

                    outputData.appendChild(dataClassId);
                    outputData.appendChild(dataClassProb);

                    outputElement.appendChild(outputSpacer);
                    outputElement.appendChild(outputTitle);
                    outputElement.appendChild(outputData);
                });

                statusOutput.textContent = statusDict[3];
            };
        }

        (async () => {
            classifier = await createClassifier("./model/model.json");
            statusOutput.textContent = statusDict[0];
        })();
    </script>
</body>
</html>


